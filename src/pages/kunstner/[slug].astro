---
import { Image } from "astro:assets";
import Mainlayout from "../../layouts/Mainlayout.astro";
import CarouselSwiper from "../../components/CarouselSwiper.astro";
import { apiDetails } from "../../settings";

export async function getStaticPaths() {
  const data = await fetch(`${apiDetails.supabaseUrl}/artist?select=*`, {
    method: "GET",
    headers: {
      apikey: apiDetails.supabaseAnonKey,
    },
  }).then((response) => response.json());

  // Laver liste med billeder i imageFolder mappen. Se astro doc: https://docs.astro.build/en/recipes/dynamically-importing-images/
  const imageFolder = "/src/assets/img/artists";
  const images = import.meta.glob<{ default: ImageMetadata }>(
    "/src/assets/img/artists/**/*.{jpeg,jpg,png,gif,webp}"
  );
  console.log(images);

  return data.map((artist) => {
    // Check if the images are in our folders, and throw an error if its not.
    artist.images.forEach((imgPath) => {
      if (!images[`${imageFolder}/${imgPath}`]) {
        throw new Error(
          `"${imgPath}" ser ud til at mangle i mappen ${imageFolder}`
        );
      }
    });

    const artistImages = artist.images.map((imgPath) =>
      images[`${imageFolder}/${imgPath}`]()
    );

    return {
      params: { slug: artist.slug },
      props: {
        artist,
        artistImages: artistImages,
      },
    };
  });
}

interface Props {
  artist: any;
  artistImages: ImageMetadata[];
}

const { artist, artistImages } = Astro.props;
---

<Mainlayout>
  <main>
    <section id="breadcrumb">
      <a href="meet_the_artists"
        ><img class="arrow" src="/src/assets/img/arrow1.svg" alt="pil" /></a
      >
      <nav>
        <ul>
          <li><a href="meet_the_artists">Mød udstillerne</a></li>
          <li><a href="artists_listview">{artist.name}</a></li>
          <li>{artist.name}</li>
        </ul>
      </nav>
    </section>
    <article class="product_container">
      <h1 class="product_headline">{artist.name}</h1>
      <section id="some_container">
        <div class="img_product">
          <CarouselSwiper
          images={artistImages}
          alt="Forårsmarked 2019 billede"
        />
        <div id="some_child">
          <div>
            <ul>
              <li class="primary_category">{artist.primary_category}</li>
              <li class="secondary_category">{artist.secondary_category}</li>
            </ul>
          </div>
          <div class="some_childchild">
            <svg
              id="insta_icon"
              class="instagram_url"
              data-name="Layer 2"
              xmlns="http://www.w3.org/2000/svg"
              xmlns:xlink="http://www.w3.org/1999/xlink"
              viewBox="0 0 46 46"
            >
              <defs>
                <style>
                  .fyld {
                    fill: #adb3ea;
                  }

                  .fyld,
                  .cls-2 {
                    stroke-width: 0px;
                  }

                  .cls-3 {
                    clip-path: url(#clippath);
                  }

                  .cls-2 {
                    fill: none;
                  }
                </style>
                <clipPath id="clippath">
                  <rect class="cls-2" width="46" height="46"></rect>
                </clipPath>
              </defs>
              <g id="Layer_1-2" data-name="Layer 1">
                <g class="cls-3">
                  <path
                    class="fyld"
                    d="M29.21,11.14h-12.43c-3.11,0-5.65,2.53-5.65,5.65v12.43c0,3.11,2.53,5.65,5.65,5.65h12.43c3.11,0,5.65-2.53,5.65-5.65v-12.43c0-3.11-2.53-5.65-5.65-5.65ZM23,29.94c-4.87,0-7.16-2.07-7.16-6.94s2.29-7.58,7.16-7.58,7.12,2.71,7.12,7.58-3.05,6.94-7.12,6.94ZM30.67,16.49c-.95,0-1.45-.57-1.45-1.52s.5-1.54,1.45-1.54,1.5.59,1.5,1.54-.55,1.52-1.5,1.52ZM23,18.37c-2.68,0-4.21,1.95-4.21,4.63s1.53,3.99,4.21,3.99,4.18-1.3,4.18-3.99-1.49-4.63-4.18-4.63ZM23,0C10.3,0,0,10.3,0,23s10.3,23,23,23,23-10.3,23-23S35.7,0,23,0ZM38.29,29.21c0,5.65-3.43,9.11-9.08,9.11h-12.43c-5.65,0-9.34-3.47-9.34-9.11v-12.43c0-5.65,3.69-9.08,9.34-9.08h12.43c5.65,0,9.08,3.43,9.08,9.08v12.43Z"
                  ></path>
                </g>
              </g>
            </svg>
            <svg
              id="facebook_icon"
              class="facebook_url"
              data-name="Layer 2"
              xmlns="http://www.w3.org/2000/svg"
              viewBox="0 0 46 46"
            >
              <defs>
                <style>
                  .fyld {
                    fill: #adb3ea;
                    stroke-width: 0px;
                  }
                </style>
              </defs>
              <g id="Layer_1-2" data-name="Layer 1">
                <path
                  class="fyld"
                  d="M23,0C10.3,0,0,10.36,0,23.14c0,11.55,8.41,21.12,19.41,22.86v-16.17h-5.84v-6.69h5.84v-5.1c0-5.8,3.43-9,8.69-9,2.52,0,5.15.45,5.15.45v5.69h-2.91c-2.85,0-3.74,1.79-3.74,3.62v4.34h6.37l-1.02,6.69h-5.35v16.17c11-1.73,19.41-11.31,19.41-22.86C46,10.36,35.7,0,23,0Z"
                ></path>
              </g>
            </svg>
          </div>
        </div>
      </section>
      <section>
        <h4 class="artist_undertitle">
          We upcycle discarded textiles to give them a longer life
        </h4>
        <p class="txt_description">{artist.description}</p>
      </section>
    </article>
  </main>
</Mainlayout>

<style>
  .arrow {
    max-width: 30px;
    padding-bottom: 5%;
    padding-top: 2%;
  }

  h6 {
    display: none;
  }

  #breadcrumb nav {
      display: block;
    }

    #breadcrumb {
      display: grid;
      grid-template-columns: 1fr 8fr;
    }

    #breadcrumb nav {
      text-align: right;
    }

    /* creating the breadcrumb foundation */
    #breadcrumb ul {
      list-style: none;
    } /* remove bullet points */
    #breadcrumb ul li {
      display: inline;
      font-size: 0.7rem;
    } /* show list items horizontally */

    /* Put an angle bracket (>) between list items */
    #breadcrumb ul li + li:before {
      content: ">";
      padding: 10px;
      font-size: 0.7rem;
    }

    #breadcrumb ul li a {
      text-decoration: none;
    } /* remove underlines from links */
    #breadcrumb ul li a:hover {
      text-decoration: underline;
    } /* show underline on mouseover */

    /* additional styling */
    ul {
      color: var(--text-color);
      font-family: "Avenir";
      font-weight: bold;
    }
    ul li a {
      color: var(--text-color);
      font-size: 0.7rem;
    }
    ul li a:visited {
      color: var(--text-color);
    }
    ul li + li:before {
      color: var(--text-color);
    }

  #some_container li {
    margin-left: 15%;
  }

  #some_child {
    display: grid;
    grid-template-columns: 1fr 1fr;
    margin-top: 30px;
    margin: 8%;
    /* grid-template-rows: 1fr 1fr; */
  }

  ul {
    grid-column: 1;
  }

  .some_childchild {
    display: flex;
    flex-direction: column;
    align-items: flex-end;
    grid-column: 2;
  }
  #insta_icon,
  #facebook_icon {
    max-width: 50px;
    margin-right: 10px;
    margin-bottom: 10px;
  }

  #insta_icon:hover .fyld,
  #facebook_icon:hover .fyld {
    fill: #6670ce;
  }
  @media (min-width: 769px) {
    h6 {
      display: block;
    }

    ul li a, #breadcrumb ul li + li:before, #breadcrumb ul li{
      font-size: 1rem;
    }

    #some_container {
      display: grid;
      grid-template-columns: 1fr 1fr;
    }
    .some_child {
      display: grid;
      grid-template-columns: 1fr 1fr;
      grid-template-rows: 1fr 1fr;
      justify-content: center;
    }

    .some_childchild {
    align-items: center;
  }

    .img_product {
      order: 1;
    }
  }
</style>